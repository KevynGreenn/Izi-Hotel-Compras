<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Izi Hotel - Requisição</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    <link rel="icon" type="image/png" href="logo.png">
</head>

<body>
    <main class="card">
        <img src="logo.png" alt="Logo Izi Hotel" class="logo">

        <div id="form-wrapper">
            <div class="form-container">
                <label for="nome">Nome Completo</label>
                <input type="text" id="nome" placeholder="Seu nome aqui">
                <span class="error-message hidden" id="error-nome">Por favor, preencha seu nome.</span>

                <label for="telefone">Telefone (WhatsApp)</label>
                <input type="text" id="telefone" placeholder="(XX) XXXXX-XXXX">
                <span class="error-message hidden" id="error-telefone">Por favor, preencha um telefone válido.</span>

                <label for="descricao">Descrição detalhada da compra</label>
                <textarea id="descricao" rows="5"
                    placeholder="Ex: 10 caixas de caneta azul, marca BIC, ponta fina."></textarea>
                <span class="error-message hidden" id="error-descricao">Por favor, descreva o produto.</span>

                <p class="aviso"><strong>Atenção:</strong> Por favor, seja o mais detalhado possível na descrição para
                    que sua solicitação seja atendida corretamente.</p>

                <label for="centro-custo">Centro de Custo</label>
                <input type="text" id="centro-custo" placeholder="Ex: Izi Express">
                <span class="error-message hidden" id="error-centro-custo">Por favor, preencha o centro de
                    custo.</span>

                <label for="valor">Valor do Produto (R$)</label>
                <input type="text" id="valor" placeholder="Ex: 150,00">
                <span class="error-message hidden" id="error-valor">Por favor, preencha o valor do produto.</span>

                <label for="data-pagamento">Data do Pagamento</label>
                <input type="date" id="data-pagamento">
                <span class="error-message hidden" id="error-data-pagamento">Por favor, selecione a data do
                    pagamento.</span>

                <label for="pagamento">Opção de Pagamento</label>
                <select id="pagamento">
                    <option value="Cartão">Cartão</option>
                    <option value="Faturado">Faturado</option>
                    <option value="Pix">Pix</option>
                </select>

                <div id="pix-field" class="hidden">
                    <label for="pix">PIX do Fornecedor</label>
                    <input type="text" id="pix" placeholder="Chave PIX do fornecedor">
                    <span class="error-message hidden" id="error-pix">Por favor, preencha a chave PIX.</span>

                    <label for="fornecedor">Nome do Fornecedor</label>
                    <input type="text" id="fornecedor" placeholder="Nome do fornecedor">
                    <span class="error-message hidden" id="error-fornecedor">Por favor, preencha o nome do
                        fornecedor.</span>
                </div>


                <button class="btn" id="submit-btn" onclick="enviarWhatsApp()">
                    <span class="btn-text">Enviar Requisição via WhatsApp</span>
                    <span class="spinner hidden"></span>
                </button>
            </div>
            <a href="index.html" class="back-link">Voltar para a Home</a>
        </div>

        <div id="confirmation-message" class="hidden">
            <div class="success-animation">
                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                    <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none" />
                    <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
                </svg>
            </div>
            <h2>Requisição Enviada!</h2>
            <p>Sua mensagem está sendo aberta no WhatsApp. Após enviar, você pode fechar a aba.</p>
            <a href="index.html" class="btn">Voltar para a Home</a>
        </div>

    </main>

    <script src="https://unpkg.com/imask"></script>

    <script>
// Pega as referências dos elementos HTML que vamos usar
const formWrapper = document.getElementById('form-wrapper');
const confirmationMessage = document.getElementById('confirmation-message');
const submitBtn = document.getElementById('submit-btn');

// Adiciona um "ouvinte" ao botão de envio. A função será executada quando ele for clicado.
submitBtn.addEventListener('click', async (event) => {
    // Previne o comportamento padrão do botão, que seria recarregar a página.
    event.preventDefault();

    // if (!validateFields()) { return; } // Você pode manter sua função de validação aqui.

    // 1. Coleta dos Dados
    // Criamos um objeto JavaScript com todos os valores dos campos do formulário.
    const dadosParaEnviar = {
        nome: document.getElementById('nome').value,
        telefone: document.getElementById('telefone').value,
        descricao: document.getElementById('descricao').value,
        centroCusto: document.getElementById('centro-custo').value,
        valor: document.getElementById('valor').value,
        dataPagamento: document.getElementById('data-pagamento').value,
        opcaoPagamento: document.getElementById('pagamento').value,
        pix: document.getElementById('pix').value,
        fornecedor: document.getElementById('fornecedor').value
    };

    // 2. Feedback Visual (Spinner)
    submitBtn.disabled = true;
    document.querySelector('.btn-text').textContent = 'Enviando...';
    document.querySelector('.spinner').classList.remove('hidden');

    try {
        // 3. A Requisição 'fetch'
        // Esta é a parte principal. Estamos enviando os dados para o nosso backend.
        const response = await fetch('https://izi-hotel-api.onrender.com', {
            method: 'POST', // O método tem que ser POST, pois estamos enviando dados.
            headers: {
                // Informamos ao servidor que estamos enviando dados em formato JSON.
                'Content-Type': 'application/json',
            },
            // Convertemos nosso objeto JavaScript para uma string no formato JSON.
            body: JSON.stringify(dadosParaEnviar),
        });

        // Se a resposta do servidor não for de sucesso (ex: erro 500), nós lançamos um erro.
        if (!response.ok) {
            throw new Error('O servidor respondeu com um erro.');
        }

        // 4. Sucesso!
        // Escondemos o formulário e mostramos a mensagem de confirmação.
        formWrapper.classList.add('hidden');
        confirmationMessage.classList.remove('hidden');

    } catch (error) {
        // 5. Tratamento de Erro
        console.error('Falha ao enviar a requisição:', error);
        alert('Não foi possível enviar a requisição. Verifique sua conexão e tente novamente.');

        // Reverte o feedback visual em caso de erro
        submitBtn.disabled = false;
        document.querySelector('.btn-text').textContent = 'Enviar Requisição via WhatsApp';
        document.querySelector('.spinner').classList.add('hidden');
    }
});

// --- Mantenha aqui o resto do seu código JavaScript ---
// (A função que mostra/esconde o campo PIX e o código do IMask para as máscaras)
pagamentoInput.addEventListener('change', function () {
    // ... seu código aqui ...
});
document.addEventListener('DOMContentLoaded', function () {
    // ... seu código do IMask aqui ...
});
    </script>
</body>

</html>